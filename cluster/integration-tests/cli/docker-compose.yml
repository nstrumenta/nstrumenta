version: '3'
services:
  server:
    build:
      context: ../../../cluster/server
      dockerfile: Dockerfile
    ports:
      - 5999:5999
    volumes:
      - ../../../cluster/credentials/:/credentials
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/credentials/nstrumenta-admin.json
      - NSTRUMENTA_API_URL=${NSTRUMENTA_API_URL}
      - NST_AGENT_TYPE=dev
    command: 'npm run start'
  cli:
    container_name: cli
    build:
      context: ../../..
      dockerfile: ./cluster/integration-tests/cli/client/Dockerfile
    environment:
      - TEST_ID=${TEST_ID}
      - NSTRUMENTA_API_KEY=${NSTRUMENTA_API_KEY}
      - NSTRUMENTA_API_URL=${NSTRUMENTA_API_URL}
